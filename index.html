<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>User Modal - Sawit Kinabalu</title>
        
        <!-- Fonts -->
        <link rel="preconnect" href="https://fonts.bunny.net">
        <link href="https://fonts.bunny.net/css?family=figtree:400,500,600,700&display=swap" rel="stylesheet" />

        <!-- Tailwind CSS -->
        <script src="https://cdn.tailwindcss.com"></script>
        <!-- Lucide Icons -->
        <script src="https://unpkg.com/lucide@latest"></script>
        
        <script>
            tailwind.config = {
                theme: {
                    extend: {
                        fontFamily: {
                            sans: ['Figtree', 'sans-serif'],
                        },
                        colors: {
                            brand: {
                                DEFAULT: '#2F4F4F',
                                hover: '#1e3636',
                            }
                        }
                    },
                },
            }
        </script>
        <style>
            /* Modal Transitions mimicking Vue's <Transition> */
            .modal-backdrop {
                background-color: rgba(0, 0, 0, 0.5);
                backdrop-filter: blur(4px);
                transition: opacity 0.2s ease;
            }
            .modal-content {
                transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            }
            .hidden {
                display: none !important;
            }
        </style>
    </head>
    <body class="font-sans text-gray-900 antialiased bg-gray-200 min-h-screen flex items-center justify-center">

        <!-- Modal Backdrop -->
        <div id="userModal" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
            
            <!-- Modal Container -->
            <div class="bg-white rounded-xl shadow-2xl w-full max-w-md modal-content overflow-hidden">

                <!-- Header -->
                <div class="flex justify-between items-center p-6 border-b border-gray-200">
                    <h3 id="modalTitle" class="text-lg font-semibold text-gray-900">Add New User</h3>
                    <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 hover:bg-gray-100 p-1 rounded transition-colors">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>

                <!-- Form Body -->
                <form onsubmit="handleSubmit(event)">
                    <div class="p-6 space-y-5">

                        <!-- Full Name -->
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Full Name</label>
                            <input
                                type="text"
                                placeholder="Enter full name"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand focus:border-transparent text-sm outline-none transition-all"
                                required
                            />
                        </div>

                        <!-- Email Address -->
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Email Address</label>
                            <input
                                type="email"
                                placeholder="name@company.com"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand focus:border-transparent text-sm outline-none transition-all"
                                required
                            />
                        </div>

                        <!-- Password -->
                        <div>
                            <label id="passwordLabel" class="block text-sm font-medium text-gray-900 mb-2">Initial Password</label>
                            <input
                                type="password"
                                placeholder="Create a strong password"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand focus:border-transparent text-sm outline-none transition-all"
                                required
                                minlength="8"
                            />
                            <p id="passwordHint" class="text-xs text-gray-500 mt-1">Must be at least 8 characters long</p>
                        </div>

                        <!-- Role & Status -->
                        <div class="grid grid-cols-2 gap-4">
                            <!-- Role Selection -->
                            <div>
                                <div class="flex justify-between items-baseline mb-2">
                                    <label class="block text-sm font-medium text-gray-900">Role</label>

                                    <!-- Role Controls -->
                                    <div id="roleControls" class="flex gap-2">
                                        <button type="button" onclick="toggleCustomRole(true)" class="flex items-center gap-1 text-brand hover:text-brand-hover text-xs font-semibold transition-colors">
                                            <i data-lucide="plus" class="w-3 h-3"></i>
                                            New
                                        </button>
                                        <button type="button" onclick="toggleCustomRole(true, true)" class="flex items-center gap-1 text-brand hover:text-brand-hover text-xs font-semibold transition-colors">
                                            <i data-lucide="edit-3" class="w-3 h-3"></i>
                                            Edit
                                        </button>
                                    </div>

                                    <button id="cancelCustomBtn" type="button" onclick="toggleCustomRole(false)" class="text-red-600 hover:text-red-700 text-xs font-semibold transition-colors hidden">
                                        Cancel
                                    </button>
                                </div>

                                <!-- Standard Role Select -->
                                <select id="roleSelect" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand focus:border-transparent text-sm outline-none">
                                    <option value="Admin">Admin</option>
                                    <option value="Manager">Manager</option>
                                    <option value="Supervisor">Supervisor</option>
                                    <option value="Staff">Staff</option>
                                </select>

                                <!-- Custom Role Input Group -->
                                <div id="customRoleGroup" class="space-y-2 hidden">
                                    <input
                                        id="customRoleInput"
                                        type="text"
                                        placeholder="Enter role name"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand focus:border-transparent text-sm outline-none"
                                    />
                                    <button
                                        type="button"
                                        onclick="applyCustomRole()"
                                        class="w-full px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium"
                                    >
                                        <span id="customRoleBtnText">Add Role</span>
                                    </button>
                                </div>
                            </div>

                            <!-- Status -->
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">Status</label>
                                <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand focus:border-transparent text-sm outline-none">
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                            </div>
                        </div>

                    </div>

                    <!-- Modal Footer -->
                    <div class="flex justify-end gap-3 p-6 bg-gray-50 border-t border-gray-200 rounded-b-xl">
                        <button type="button" onclick="closeModal()" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors text-sm font-medium">
                            Cancel
                        </button>
                        <button type="submit" id="submitBtn" class="px-4 py-2 bg-brand text-white rounded-lg hover:bg-brand-hover transition-colors text-sm font-medium shadow-sm transform active:scale-95">
                            Add User
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <script>
            // Initialize Icons
            lucide.createIcons();

            // Modal Logic
            function closeModal() {
                const modal = document.getElementById('userModal');
                modal.style.opacity = '0';
                setTimeout(() => {
                    // In a real app, this would remove the element or hide it
                    alert("Modal closed. Refresh to see it again.");
                }, 200);
            }

            // Custom Role Logic
            function toggleCustomRole(show, isEdit = false) {
                const controls = document.getElementById('roleControls');
                const cancelBtn = document.getElementById('cancelCustomBtn');
                const roleSelect = document.getElementById('roleSelect');
                const customGroup = document.getElementById('customRoleGroup');
                const customInput = document.getElementById('customRoleInput');
                const customBtnText = document.getElementById('customRoleBtnText');

                if (show) {
                    controls.classList.add('hidden');
                    cancelBtn.classList.remove('hidden');
                    roleSelect.classList.add('hidden');
                    customGroup.classList.remove('hidden');
                    
                    if (isEdit) {
                        customInput.value = roleSelect.value;
                        customBtnText.innerText = "Update Role";
                    } else {
                        customInput.value = "";
                        customBtnText.innerText = "Add Role";
                    }
                    customInput.focus();
                } else {
                    controls.classList.remove('hidden');
                    cancelBtn.classList.add('hidden');
                    roleSelect.classList.remove('hidden');
                    customGroup.classList.add('hidden');
                }
            }

            function applyCustomRole() {
                const input = document.getElementById('customRoleInput');
                const roleSelect = document.getElementById('roleSelect');
                
                if (input.value.trim() === "") {
                    alert("Please enter a role name");
                    return;
                }

                // Add to select if not exists
                const val = input.value.trim();
                let exists = false;
                for (let i = 0; i < roleSelect.options.length; i++) {
                    if (roleSelect.options[i].value === val) exists = true;
                }

                if (!exists) {
                    const option = document.createElement("option");
                    option.text = val;
                    option.value = val;
                    roleSelect.add(option);
                }

                roleSelect.value = val;
                toggleCustomRole(false);
            }

            function handleSubmit(e) {
                e.preventDefault();
                const btn = document.getElementById('submitBtn');
                btn.disabled = true;
                btn.innerText = "Processing...";
                
                setTimeout(() => {
                    alert("Form Submitted Successfully!");
                    btn.disabled = false;
                    btn.innerText = "Add User";
                }, 1000);
            }

            // Demo: Toggle Edit Mode (Press 'e' key to simulate)
            window.addEventListener('keydown', (e) => {
                if (e.key === 'e') {
                    document.getElementById('modalTitle').innerText = "Edit User";
                    document.getElementById('passwordLabel').innerText = "New Password (optional)";
                    document.getElementById('passwordHint').innerText = "Leave blank to keep current password";
                    document.getElementById('submitBtn').innerText = "Update User";
                }
            });
        </script>
    </body>
</html>
