<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BovineFlow - Cattle Management System</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#34554a',
            'primary-dark': '#2a443b',
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          }
        }
      }
    }
  </script>
  <style>
    :root {
      --primary: #2E7D32;
      --primary-dark: #1B5E20;
      --primary-light: #4CAF50;
      --secondary: #1565C0;
      --accent: #FF6F00;
      --success: #2E7D32;
      --warning: #ED6C02;
      --danger: #D32F2F;
      --info: #0288D1;
      --grey-50: #FAFAFA;
      --grey-100: #F5F5F5;
      --grey-200: #EEEEEE;
      --grey-300: #E0E0E0;
      --grey-400: #BDBDBD;
      --grey-500: #9E9E9E;
      --grey-600: #757575;
      --grey-700: #616161;
      --grey-800: #424242;
      --grey-900: #212121;
      --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.08);
      --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 16px;
      --transition: all 0.3s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--grey-100);
      color: var(--grey-800);
      line-height: 1.6;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      position: fixed;
      left: 0;
      top: 0;
      width: 280px;
      height: 100vh;
      background: linear-gradient(180deg, var(--primary-dark) 0%, var(--primary) 100%);
      color: white;
      z-index: 1000;
      box-shadow: var(--shadow-lg);
      overflow-y: auto;
    }

    .sidebar-header {
      padding: 24px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .sidebar-logo {
      width: 48px;
      height: 48px;
      background: rgba(255, 255, 255, 0.15);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }

    .sidebar-title {
      font-size: 20px;
      font-weight: 700;
    }

    .sidebar-subtitle {
      font-size: 11px;
      opacity: 0.7;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .nav-section {
      padding: 20px 0 0;
    }

    .nav-section-title {
      padding: 0 20px 10px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      opacity: 0.5;
      font-weight: 600;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 14px 20px;
      color: rgba(255, 255, 255, 0.85);
      cursor: pointer;
      transition: var(--transition);
      border-left: 3px solid transparent;
      font-weight: 500;
    }

    .nav-item:hover {
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }

    .nav-item.active {
      background: rgba(255, 255, 255, 0.15);
      color: white;
      border-left-color: white;
    }

    .nav-item i {
      width: 22px;
      font-size: 18px;
    }

    .nav-badge {
      margin-left: auto;
      background: var(--accent);
      color: white;
      padding: 2px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    /* Main Content */
    .main-content {
      margin-left: 280px;
      min-height: 100vh;
    }

    .top-header {
      background: white;
      padding: 16px 32px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: var(--shadow-sm);
      position: sticky;
      top: 0;
      z-index: 100;
      flex-wrap: wrap;
      gap: 16px;
    }

    .header-left h1 {
      font-size: 24px;
      font-weight: 700;
      color: var(--grey-900);
    }

    .header-left p {
      color: var(--grey-500);
      font-size: 14px;
      margin-top: 2px;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
    }

    .role-switcher {
      display: flex;
      align-items: center;
      gap: 12px;
      background: var(--grey-100);
      padding: 8px 16px;
      border-radius: var(--radius-md);
    }

    .role-switcher label {
      font-size: 12px;
      font-weight: 600;
      color: var(--grey-600);
      text-transform: uppercase;
    }

    .role-switcher select {
      padding: 8px 12px;
      border: 1px solid var(--grey-300);
      border-radius: var(--radius-sm);
      background: white;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      min-width: 140px;
    }

    .role-switcher select:focus {
      outline: none;
      border-color: var(--primary);
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 8px 16px;
      background: var(--primary);
      color: white;
      border-radius: var(--radius-md);
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
    }

    .user-name {
      font-weight: 600;
      font-size: 14px;
    }

    .user-role {
      font-size: 11px;
      opacity: 0.85;
    }

    .notification-btn {
      position: relative;
      width: 40px;
      height: 40px;
      border: none;
      background: var(--grey-100);
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      color: var(--grey-600);
    }

    .notification-btn:hover {
      background: var(--grey-200);
    }

    .notification-count {
      position: absolute;
      top: 2px;
      right: 2px;
      width: 18px;
      height: 18px;
      background: var(--danger);
      color: white;
      border-radius: 50%;
      font-size: 10px;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Content */
    .content-area {
      padding: 32px;
    }

    .dashboard-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 24px;
      margin-bottom: 32px;
    }

    .stat-card {
      background: white;
      border-radius: var(--radius-lg);
      padding: 24px;
      box-shadow: var(--shadow-sm);
      transition: var(--transition);
    }

    .stat-card:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }

    .stat-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
    }

    .stat-icon {
      width: 52px;
      height: 52px;
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }

    .stat-icon.pending {
      background: rgba(237, 108, 2, 0.1);
      color: var(--warning);
    }

    .stat-icon.verified {
      background: rgba(2, 136, 209, 0.1);
      color: var(--info);
    }

    .stat-icon.completed {
      background: rgba(46, 125, 50, 0.1);
      color: var(--success);
    }

    .stat-icon.total {
      background: rgba(21, 101, 192, 0.1);
      color: var(--secondary);
    }

    .stat-value {
      font-size: 36px;
      font-weight: 700;
      color: var(--grey-900);
      margin-bottom: 4px;
    }

    .stat-label {
      color: var(--grey-500);
      font-size: 14px;
      font-weight: 500;
    }

    /* Panels & Tables */
    .panel {
      background: white;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      margin-bottom: 24px;
      overflow: hidden;
    }

    .panel-header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--grey-200);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 16px;
    }

    .panel-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--grey-900);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .panel-title i {
      color: var(--primary);
    }

    .panel-body {
      padding: 24px;
    }

    .header-filters {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
    }

    .data-table th {
      text-align: left;
      padding: 12px 14px;
      font-size: 11px;
      font-weight: 600;
      color: var(--grey-600);
      text-transform: uppercase;
      background: var(--grey-100);
      border: 1px solid var(--grey-200);
    }

    .data-table td {
      padding: 12px 14px;
      border: 1px solid var(--grey-200);
      font-size: 13px;
    }

    .data-table tbody tr {
      transition: var(--transition);
    }

    .data-table tbody tr:hover {
      background: var(--grey-50);
    }

    .table-container {
      overflow-x: auto;
      margin-bottom: 16px;
    }

    .livestock-table {
      width: 100%;
      min-width: 900px;
      border-collapse: collapse;
      font-size: 13px;
    }

    .livestock-table th {
      background: var(--primary);
      color: white;
      padding: 12px 10px;
      text-align: left;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      white-space: nowrap;
    }

    .livestock-table td {
      padding: 10px;
      border: 1px solid var(--grey-300);
      background: white;
    }

    .livestock-table input,
    .livestock-table select {
      width: 100%;
      padding: 8px;
      border: 1px solid var(--grey-300);
      border-radius: 4px;
      font-size: 13px;
    }

    .livestock-table input:focus,
    .livestock-table select:focus {
      outline: none;
      border-color: var(--primary);
    }

    .livestock-table .total-row {
      background: var(--grey-100);
      font-weight: 600;
    }

    /* ISO Header & Footer */
    .iso-header {
      background: var(--grey-900);
      color: white;
      padding: 12px 20px;
      border-radius: var(--radius-sm);
      margin-bottom: 20px;
    }

    .iso-header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 12px;
    }

    .iso-title {
      font-size: 14px;
      font-weight: 700;
    }

    .iso-meta {
      display: flex;
      gap: 20px;
      font-size: 12px;
      opacity: 0.9;
    }

    .distribution-footer {
      background: var(--grey-100);
      border-top: 2px solid var(--grey-300);
      padding: 12px 20px;
      margin-top: 24px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .dist-label {
      font-size: 10px;
      font-weight: 600;
      color: var(--grey-600);
      text-transform: uppercase;
      padding: 4px 10px;
      background: white;
      border: 1px solid var(--grey-300);
      border-radius: 4px;
    }

    /* Signature Section */
    .signature-section {
      background: var(--grey-50);
      border: 1px solid var(--grey-200);
      border-radius: var(--radius-md);
      padding: 20px;
      margin-top: 24px;
    }

    .section-title {
      font-size: 15px;
      font-weight: 600;
      color: var(--grey-800);
      margin-bottom: 16px;
      padding-bottom: 8px;
      border-bottom: 2px solid var(--primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .section-title i {
      color: var(--primary);
    }

    .sig-row-5 {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 12px;
      margin-bottom: 16px;
    }

    .sig-row-4 {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }

    .sig-row-3 {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }

    .sig-block {
      background: white;
      border: 1px solid var(--grey-300);
      border-radius: var(--radius-sm);
      padding: 12px;
    }

    .sig-title {
      font-size: 11px;
      font-weight: 600;
      color: var(--grey-700);
      margin-bottom: 8px;
      text-transform: uppercase;
    }

    .sig-title span {
      font-weight: 400;
      color: var(--grey-500);
      text-transform: none;
    }

    .sig-pad {
      border: 2px dashed var(--grey-300);
      border-radius: var(--radius-sm);
      height: 60px;
      background: var(--grey-50);
      margin-bottom: 10px;
    }

    .sig-fields {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .sig-fields input {
      padding: 6px 10px;
      border: 1px solid var(--grey-300);
      border-radius: 4px;
      font-size: 12px;
    }

    .sig-date {
      font-size: 11px;
      color: var(--grey-500);
    }

    /* Buttons */
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: var(--radius-sm);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
      box-shadow: var(--shadow-md);
    }

    .btn-secondary {
      background: var(--grey-100);
      color: var(--grey-700);
      border: 1px solid var(--grey-300);
    }

    .btn-secondary:hover {
      background: var(--grey-200);
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    .btn-success:hover {
      background: #1B5E20;
    }

    .btn-danger {
      background: var(--danger);
      color: white;
    }

    .btn-danger:hover {
      background: #B71C1C;
    }

    .btn-warning {
      background: var(--warning);
      color: white;
    }

    .btn-sm {
      padding: 8px 16px;
      font-size: 13px;
    }

    .btn-lg {
      padding: 14px 28px;
      font-size: 15px;
    }

    .btn-icon {
      padding: 8px 12px;
      min-width: 36px;
    }

    .action-buttons {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 24px;
    }

    .add-row-btn {
      padding: 10px 16px;
      background: var(--grey-100);
      border: 2px dashed var(--grey-300);
      border-radius: var(--radius-sm);
      color: var(--grey-600);
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .add-row-btn:hover {
      border-color: var(--primary);
      color: var(--primary);
      background: rgba(46, 125, 50, 0.05);
    }

    /* Forms */
    .form-group {
      margin-bottom: 16px;
    }

    .form-label {
      display: block;
      font-size: 12px;
      font-weight: 600;
      color: var(--grey-700);
      margin-bottom: 6px;
      text-transform: uppercase;
    }

    .form-input,
    .form-select,
    .form-textarea {
      width: 100%;
      padding: 10px 14px;
      border: 1px solid var(--grey-300);
      border-radius: var(--radius-sm);
      font-size: 14px;
      color: var(--grey-800);
      transition: var(--transition);
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
    }

    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 16px;
    }

    .doc-info-value {
      font-size: 14px;
      font-weight: 600;
      color: var(--primary);
      font-family: monospace;
    }

    /* Status Badges */
    .status-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .status-badge.pending {
      background: rgba(237, 108, 2, 0.1);
      color: var(--warning);
    }

    .status-badge.in-progress {
      background: rgba(2, 136, 209, 0.1);
      color: var(--info);
    }

    .status-badge.completed,
    .status-badge.approved {
      background: rgba(46, 125, 50, 0.1);
      color: var(--success);
    }

    .tag {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
      background: var(--grey-200);
      color: var(--grey-700);
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: flex-start;
      justify-content: center;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: var(--transition);
      padding: 40px 20px;
      overflow-y: auto;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: white;
      border-radius: var(--radius-lg);
      width: 100%;
      max-width: 600px;
      box-shadow: var(--shadow-lg);
      transform: translateY(20px);
      transition: var(--transition);
    }

    .modal-lg {
      max-width: 1000px;
    }

    .modal-overlay.active .modal {
      transform: translateY(0);
    }

    .modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--grey-200);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      background: white;
      z-index: 10;
      border-radius: var(--radius-lg) var(--radius-lg) 0 0;
    }

    .modal-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--grey-900);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .modal-title i {
      color: var(--primary);
    }

    .modal-close {
      width: 36px;
      height: 36px;
      border: none;
      background: var(--grey-100);
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      color: var(--grey-600);
      transition: var(--transition);
    }

    .modal-close:hover {
      background: var(--grey-200);
      color: var(--grey-800);
    }

    .modal-body {
      padding: 24px;
    }

    .modal-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
    }

    .modal-left,
    .modal-right {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    /* Workflow Stepper */
    .workflow-stepper {
      display: flex;
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
      padding: 16px;
      background: var(--grey-50);
      border-radius: var(--radius-md);
      margin-bottom: 24px;
    }

    .wf-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 80px;
    }

    .wf-step-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      background: var(--grey-200);
      color: var(--grey-500);
      margin-bottom: 6px;
      transition: var(--transition);
      border: 2px solid transparent;
    }

    .wf-step.completed .wf-step-icon {
      background: var(--success);
      color: white;
    }

    .wf-step.active .wf-step-icon {
      background: white;
      color: var(--primary);
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(46, 125, 50, 0.2);
    }

    .wf-step-label {
      font-size: 10px;
      font-weight: 600;
      color: var(--grey-500);
      text-align: center;
      max-width: 70px;
    }

    .wf-step.completed .wf-step-label,
    .wf-step.active .wf-step-label {
      color: var(--grey-800);
    }

    .wf-arrow {
      color: var(--grey-300);
      font-size: 14px;
      display: flex;
      align-items: center;
      padding-bottom: 20px;
    }

    /* Info Sections */
    .info-section {
      background: var(--grey-50);
      border-radius: var(--radius-md);
      padding: 16px;
    }

    .info-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--grey-800);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .info-title i {
      color: var(--primary);
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid var(--grey-200);
      font-size: 13px;
    }

    .info-row:last-child {
      border-bottom: none;
    }

    .info-row span:first-child {
      color: var(--grey-500);
    }

    .info-row span:last-child {
      font-weight: 500;
      color: var(--grey-800);
    }

    /* Timeline */
    .timeline {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .timeline-item {
      display: flex;
      gap: 12px;
    }

    .timeline-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--primary);
      margin-top: 4px;
      flex-shrink: 0;
    }

    .timeline-content {
      flex: 1;
    }

    .timeline-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }

    .timeline-title {
      font-weight: 600;
      color: var(--grey-800);
      font-size: 13px;
    }

    .timeline-time {
      font-size: 11px;
      color: var(--grey-500);
    }

    .timeline-user {
      font-size: 12px;
      color: var(--grey-600);
      margin-bottom: 8px;
    }

    .timeline-file {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      background: white;
      border: 1px solid var(--grey-200);
      border-radius: var(--radius-sm);
    }

    .timeline-file-icon {
      width: 32px;
      height: 32px;
      background: rgba(211, 47, 47, 0.1);
      color: var(--danger);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .timeline-file-info {
      flex: 1;
    }

    .timeline-file-name {
      font-weight: 500;
      font-size: 12px;
      color: var(--grey-800);
    }

    .timeline-file-size {
      font-size: 10px;
      color: var(--grey-500);
    }

    .timeline-file-btn {
      padding: 6px 10px;
      background: var(--grey-100);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      color: var(--grey-600);
    }

    .timeline-file-btn:hover {
      background: var(--grey-200);
    }

    /* Audit Log */
    .audit-log {
      max-height: 200px;
      overflow-y: auto;
    }

    .audit-item {
      display: flex;
      gap: 10px;
      padding: 10px 0;
      border-bottom: 1px solid var(--grey-200);
    }

    .audit-item:last-child {
      border-bottom: none;
    }

    .audit-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--primary);
      margin-top: 6px;
      flex-shrink: 0;
    }

    .audit-content {
      flex: 1;
    }

    .audit-text {
      font-size: 13px;
      color: var(--grey-800);
    }

    .audit-text strong {
      font-weight: 600;
    }

    .audit-time {
      font-size: 11px;
      color: var(--grey-500);
      margin-top: 2px;
    }

    /* Workflow Actions */
    .workflow-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin: 20px 0;
      padding: 16px;
      background: var(--grey-50);
      border-radius: var(--radius-md);
    }

    /* File Upload */
    .attachments-section {
      margin-top: 20px;
      padding: 16px;
      background: var(--grey-50);
      border-radius: var(--radius-md);
    }

    .file-upload-area {
      border: 2px dashed var(--grey-300);
      border-radius: var(--radius-md);
      padding: 30px;
      text-align: center;
      background: white;
      transition: var(--transition);
    }

    .file-upload-area:hover {
      border-color: var(--primary);
      background: rgba(46, 125, 50, 0.02);
    }

    .file-upload-area i {
      font-size: 40px;
      color: var(--grey-400);
      margin-bottom: 12px;
    }

    .file-upload-area p {
      color: var(--grey-500);
      margin-bottom: 16px;
    }

    .uploaded-files {
      margin-top: 16px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .uploaded-file {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      background: white;
      border: 1px solid var(--grey-200);
      border-radius: var(--radius-sm);
    }

    .uploaded-file-icon {
      width: 32px;
      height: 32px;
      background: rgba(211, 47, 47, 0.1);
      color: var(--danger);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .uploaded-file-info {
      flex: 1;
    }

    .uploaded-file-name {
      font-weight: 500;
      font-size: 13px;
    }

    .uploaded-file-meta {
      font-size: 11px;
      color: var(--grey-500);
    }

    /* Workflow History */
    .workflow-history {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .wh-item {
      display: flex;
      gap: 12px;
      padding: 12px;
      background: white;
      border-radius: var(--radius-sm);
      border-left: 3px solid var(--primary);
    }

    .wh-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--primary);
      margin-top: 4px;
    }

    .wh-content {
      flex: 1;
    }

    .wh-title {
      font-weight: 600;
      font-size: 13px;
      color: var(--grey-800);
    }

    .wh-meta {
      font-size: 11px;
      color: var(--grey-500);
      margin-top: 2px;
    }

    .hidden {
      display: none !important;
    }

    /* Custom Scrollbar */
    .custom-scrollbar::-webkit-scrollbar {
      width: 4px;
    }

    .custom-scrollbar::-webkit-scrollbar-track {
      background: transparent;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: #e2e8f0;
      border-radius: 10px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: #cbd5e1;
    }

    /* Responsive */
    @media (max-width: 1200px) {
      .sidebar {
        width: 80px;
      }

      .sidebar-title,
      .sidebar-subtitle,
      .nav-section-title,
      .nav-item span {
        display: none;
      }

      .nav-item {
        justify-content: center;
        padding: 16px;
      }

      .main-content {
        margin-left: 80px;
      }

      .sig-row-5 {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
      }

      .main-content {
        margin-left: 0;
      }

      .form-row,
      .sig-row-5,
      .sig-row-4,
      .sig-row-3 {
        grid-template-columns: 1fr;
      }

      .modal-grid {
        grid-template-columns: 1fr;
      }

      .workflow-stepper {
        gap: 4px;
      }

      .wf-arrow {
        display: none;
      }
    }
  </style>
</head>

<body class="bg-gray-100 min-h-screen">
  <!-- Sidebar -->
  <nav
    class="sidebar fixed left-0 top-0 h-screen bg-gradient-to-b from-primary-dark to-primary text-white z-50 shadow-xl overflow-y-auto">
    <div class="p-6 border-b border-white/10 flex items-center gap-3">
      <div class="w-12 h-12 bg-white/15 rounded-xl flex items-center justify-center text-2xl"><i class="fas fa-cow"></i>
      </div>
      <div>
        <div class="sidebar-title text-xl font-bold tracking-tight">BovineFlow</div>
        <div class="sidebar-subtitle text-xs opacity-70 uppercase tracking-widest">Cattle Management</div>
      </div>
    </div>
    <div class="py-5">
      <div class="nav-section-title px-5 pb-2 text-xs uppercase tracking-widest opacity-50 font-semibold">Main Menu
      </div>
      <div
        class="nav-item flex items-center gap-3 px-5 py-3.5 cursor-pointer border-l-[3px] border-transparent hover:bg-white/10 text-white/85 font-medium active"
        data-page="dashboard">
        <i class="fas fa-th-large w-5 text-lg"></i><span class="nav-text">Dashboard</span>
      </div>
      <div
        class="nav-item flex items-center gap-3 px-5 py-3.5 cursor-pointer border-l-[3px] border-transparent hover:bg-white/10 text-white/85 font-medium"
        data-page="create-ctv">
        <i class="fas fa-plus-circle w-5 text-lg"></i><span class="nav-text">Create CTV</span>
      </div>
      <div
        class="nav-item flex items-center gap-3 px-5 py-3.5 cursor-pointer border-l-[3px] border-transparent hover:bg-white/10 text-white/85 font-medium"
        data-page="create-receival">
        <i class="fas fa-truck-loading w-5 text-lg"></i><span class="nav-text">Create Receival Form</span>
      </div>
      <div
        class="nav-item flex items-center gap-3 px-5 py-3.5 cursor-pointer border-l-[3px] border-transparent hover:bg-white/10 text-white/85 font-medium"
        data-page="create-siv">
        <i class="fas fa-file-invoice w-5 text-lg"></i><span class="nav-text">Create SIV</span>
      </div>
    </div>
    <div class="py-2">
      <div class="nav-section-title px-5 pb-2 text-xs uppercase tracking-widest opacity-50 font-semibold">Approvals
      </div>
      <div
        class="nav-item flex items-center gap-3 px-5 py-3.5 cursor-pointer border-l-[3px] border-transparent hover:bg-white/10 text-white/85 font-medium"
        data-page="pending">
        <i class="fas fa-clock w-5 text-lg"></i><span class="nav-text">Pending</span>
        <span class="nav-text ml-auto bg-orange-500 text-white px-2.5 py-0.5 rounded-full text-xs font-bold"
          id="pending-count">3</span>
      </div>
      <div
        class="nav-item flex items-center gap-3 px-5 py-3.5 cursor-pointer border-l-[3px] border-transparent hover:bg-white/10 text-white/85 font-medium"
        data-page="completed">
        <i class="fas fa-check-circle w-5 text-lg"></i><span class="nav-text">Completed</span>
      </div>
      <div
        class="nav-item flex items-center gap-3 px-5 py-3.5 cursor-pointer border-l-[3px] border-transparent hover:bg-white/10 text-white/85 font-medium"
        data-page="history">
        <i class="fas fa-history w-5 text-lg"></i><span class="nav-text">Transfer History</span>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="main-content ml-[280px] min-h-screen">
    <!-- Top Header -->
    <header
      class="bg-white px-8 py-4 flex justify-between items-center shadow-sm sticky top-0 z-40 border-b border-gray-100">
      <div>
        <h1 id="page-title" class="text-2xl font-bold text-gray-900 tracking-tight">Dashboard</h1>
        <p id="page-subtitle" class="text-sm text-gray-500 mt-0.5">Overview of cattle transfer activities</p>
      </div>
      <div class="flex items-center gap-4">
        <div class="flex items-center gap-3 bg-gray-100 px-4 py-2 rounded-lg">
          <label class="text-xs font-bold text-gray-500 uppercase tracking-wide"><i class="fas fa-user-tag mr-1"></i>
            Role:</label>
          <select id="role-selector"
            class="px-3 py-1.5 border border-gray-200 rounded-lg bg-white text-sm font-medium text-gray-700 outline-none focus:ring-2 focus:ring-primary min-w-[140px]">
            <option value="">Select Role</option>
            <option value="sapp">SAPP-Integration</option>
            <option value="manager">Livestock Manager</option>
            <option value="driver">Driver</option>
            <option value="estate">Estate Personal</option>
            <option value="security">Gate House Security</option>
            <option value="supervisor">Livestock Supervisor/Assistant</option>
            <option value="operator">Operator</option>
          </select>
          <select id="user-selector"
            class="px-3 py-1.5 border border-gray-200 rounded-lg bg-white text-sm font-medium text-gray-700 outline-none focus:ring-2 focus:ring-primary min-w-[160px]">
            <option value="">Select Name</option>
          </select>
        </div>
        <div id="user-info" class="hidden items-center gap-3 bg-primary text-white px-4 py-2 rounded-lg">
          <div id="user-avatar" class="w-9 h-9 bg-white/20 rounded-full flex items-center justify-center font-bold">-
          </div>
          <div>
            <div id="current-user-name" class="font-semibold text-sm">-</div>
            <div id="current-user-role" class="text-xs opacity-85">-</div>
          </div>
        </div>
        <button
          class="relative w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center text-gray-500 hover:bg-gray-200 transition-colors">
          <i class="fas fa-bell text-lg"></i>
          <span id="notif-count"
            class="absolute -top-0.5 -right-0.5 w-5 h-5 bg-red-500 text-white rounded-full text-[10px] font-bold flex items-center justify-center">3</span>
        </button>
      </div>
    </header>

    <div class="p-8">
      <!-- Dashboard Page -->
      <div id="page-dashboard" class="page">
        <div class="mb-8">
          <h1 class="text-2xl font-bold text-gray-900 tracking-tight">Cattle Transfer Dashboard</h1>
          <p class="text-sm text-gray-500 mt-1">Monitor transfer activities, track pending approvals, and view completed
            transfers.</p>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
          <div class="bg-white p-6 rounded-xl border border-gray-100 flex items-center gap-5 shadow-sm">
            <div class="w-14 h-14 rounded-full bg-amber-50 text-amber-600 flex items-center justify-center"><i
                class="fas fa-clock text-2xl"></i></div>
            <div>
              <p class="text-xs text-gray-500 font-bold uppercase tracking-wide">Pending</p>
              <p id="stat-pending" class="text-3xl font-black text-gray-900">3</p>
            </div>
          </div>
          <div class="bg-white p-6 rounded-xl border border-gray-100 flex items-center gap-5 shadow-sm">
            <div class="w-14 h-14 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center"><i
                class="fas fa-spinner text-2xl"></i></div>
            <div>
              <p class="text-xs text-gray-500 font-bold uppercase tracking-wide">In Progress</p>
              <p id="stat-in-progress" class="text-3xl font-black text-gray-900">2</p>
            </div>
          </div>
          <div class="bg-white p-6 rounded-xl border border-gray-100 flex items-center gap-5 shadow-sm">
            <div class="w-14 h-14 rounded-full bg-green-50 text-green-600 flex items-center justify-center"><i
                class="fas fa-check-circle text-2xl"></i></div>
            <div>
              <p class="text-xs text-gray-500 font-bold uppercase tracking-wide">Completed</p>
              <p id="stat-completed" class="text-3xl font-black text-gray-900">12</p>
            </div>
          </div>
          <div class="bg-white p-6 rounded-xl border border-red-100 flex items-center gap-5 shadow-sm">
            <div class="w-14 h-14 rounded-full bg-red-50 text-red-600 flex items-center justify-center"><i
                class="fas fa-exclamation-triangle text-2xl"></i></div>
            <div>
              <p class="text-xs text-red-600 font-bold uppercase tracking-wide">Total Records</p>
              <p id="stat-total" class="text-3xl font-black text-red-600">17</p>
            </div>
          </div>
        </div>

        <!-- Filter Bar -->
        <div
          class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4 bg-white p-4 rounded-xl border border-gray-200 shadow-sm">
          <div class="flex flex-1 gap-2 w-full md:w-auto">
            <div class="relative flex-1">
              <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
              <input type="text" id="dashboard-search" placeholder="Search documents..."
                class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-200 outline-none text-sm focus:ring-2 focus:ring-primary">
            </div>
            <select
              class="px-3 py-2 rounded-lg border border-gray-200 bg-gray-50 text-gray-600 text-sm outline-none focus:ring-2 focus:ring-primary">
              <option value="">All Types</option>
              <option value="CTV">CTV</option>
              <option value="Receival">Receival</option>
              <option value="SIV">SIV</option>
            </select>
          </div>
          <div class="flex gap-2">
            <button onclick="showPage('create-ctv')"
              class="flex items-center gap-2 bg-primary text-white px-4 py-2 rounded-lg font-medium hover:bg-primary-dark text-sm shadow-sm transition-colors">
              <i class="fas fa-plus"></i> New Transfer
            </button>
          </div>
        </div>

        <!-- Recent Pending Table -->
        <div class="bg-white rounded-xl shadow-sm overflow-hidden border border-gray-200">
          <div class="p-5 border-b border-gray-100 flex justify-between items-center">
            <h3 class="text-lg font-bold text-gray-900 tracking-tight flex items-center gap-2"><i
                class="fas fa-clock text-primary"></i> Recent Pending</h3>
            <button onclick="showPage('pending')" class="text-sm text-primary font-semibold hover:underline">View All
              â†’</button>
          </div>
          <div class="overflow-x-auto">
            <table class="w-full text-left whitespace-nowrap">
              <thead>
                <tr class="bg-primary text-white text-sm">
                  <th class="p-4 font-semibold">Document</th>
                  <th class="p-4 font-semibold">Type</th>
                  <th class="p-4 font-semibold">From</th>
                  <th class="p-4 font-semibold">Current Step</th>
                  <th class="p-4 font-semibold text-right">Actions</th>
                </tr>
              </thead>
              <tbody id="recent-pending-table" class="divide-y text-sm text-gray-700"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Create CTV Page -->
      <div id="page-create-ctv" class="page hidden">
        <div class="mb-8">
          <h1 class="text-2xl font-bold text-gray-900 tracking-tight">Create Transfer Voucher (CTV)</h1>
          <p class="text-sm text-gray-500 mt-1">Create new inter-unit cattle transfer document.</p>
        </div>
        <form id="ctv-form">
          <div
            class="bg-gray-900 text-white px-5 py-3 rounded-lg mb-6 flex justify-between items-center flex-wrap gap-3">
            <div class="font-bold text-sm">SAWIT KINABALU FARM PRODUCTS SDN BHD (Co.No.465571-P)</div>
            <div class="flex gap-6 text-xs opacity-90"><span>Doc: SKFP/HACCP/FM-08</span><span>Rev: 01</span></div>
          </div>
          <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center">
              <h3 class="text-lg font-bold text-gray-900 flex items-center gap-2"><i
                  class="fas fa-truck text-primary"></i> CATTLE TRANSFER VOUCHER</h3>
              <span class="text-primary font-mono font-bold" id="ctv-number">CTV-2025-0001</span>
            </div>
            <div class="p-6">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div><label class="block text-xs font-bold text-gray-600 uppercase tracking-wide mb-1.5">Transfer From
                    *</label><select
                    class="w-full p-2.5 border border-gray-200 rounded-lg bg-white text-sm focus:ring-2 focus:ring-primary outline-none"
                    id="ctv-from" required>
                    <option value="">Select Source</option>
                    <option>SG FALDA</option>
                    <option>SG AA</option>
                    <option>SKLIC Breedlot</option>
                  </select></div>
                <div><label class="block text-xs font-bold text-gray-600 uppercase tracking-wide mb-1.5">Transfer To
                    *</label><select
                    class="w-full p-2.5 border border-gray-200 rounded-lg bg-white text-sm focus:ring-2 focus:ring-primary outline-none"
                    id="ctv-to" required>
                    <option value="">Select Destination</option>
                    <option>SELIC</option>
                    <option>SKFP-Butchery</option>
                  </select></div>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div><label class="block text-xs font-bold text-gray-600 uppercase tracking-wide mb-1.5">Date
                    *</label><input type="date"
                    class="w-full p-2.5 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-primary outline-none"
                    id="ctv-date" required></div>
                <div><label
                    class="block text-xs font-bold text-gray-600 uppercase tracking-wide mb-1.5">Time</label><input
                    type="time"
                    class="w-full p-2.5 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-primary outline-none"
                    id="ctv-time"></div>
                <div><label class="block text-xs font-bold text-gray-600 uppercase tracking-wide mb-1.5">Vehicle No.
                    *</label><input type="text"
                    class="w-full p-2.5 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-primary outline-none"
                    id="ctv-vehicle" placeholder="SYK 6112" required></div>
              </div>

              <h4 class="text-sm font-bold text-gray-800 mb-3 pb-2 border-b-2 border-primary flex items-center gap-2"><i
                  class="fas fa-list text-primary"></i> Livestock Particulars</h4>
              <div class="overflow-x-auto mb-4">
                <table class="w-full text-left whitespace-nowrap min-w-[800px]">
                  <thead>
                    <tr class="bg-primary text-white text-xs">
                      <th class="p-3 font-semibold">No.</th>
                      <th class="p-3 font-semibold">Tag No.</th>
                      <th class="p-3 font-semibold">Category</th>
                      <th class="p-3 font-semibold">Colour</th>
                      <th class="p-3 font-semibold">Weight</th>
                      <th class="p-3 font-semibold">Good</th>
                      <th class="p-3 font-semibold">Not Good</th>
                      <th class="p-3 font-semibold">Remarks</th>
                      <th class="p-3 font-semibold">Purpose</th>
                      <th class="p-3 font-semibold"></th>
                    </tr>
                  </thead>
                  <tbody id="ctv-livestock-body" class="text-sm"></tbody>
                </table>
              </div>
              <button type="button" onclick="addCTVRow()"
                class="px-4 py-2 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 text-sm font-medium hover:border-primary hover:text-primary transition-colors"><i
                  class="fas fa-plus mr-2"></i>Add Livestock</button>

              <!-- Signatures -->
              <div class="bg-gray-50 border border-gray-200 rounded-xl p-5 mt-6">
                <h4 class="text-sm font-bold text-gray-800 mb-4 pb-2 border-b-2 border-primary flex items-center gap-2">
                  <i class="fas fa-signature text-primary"></i> Signatures & Authorization</h4>
                <div class="grid grid-cols-2 md:grid-cols-5 gap-3 mb-4">
                  <div class="bg-white border border-gray-200 rounded-lg p-3">
                    <div class="text-[10px] font-bold text-gray-600 uppercase mb-2">Issued By <span
                        class="font-normal text-gray-400">(SAPP)</span></div>
                    <div class="h-12 border-2 border-dashed border-gray-200 rounded mb-2"></div><input type="text"
                      placeholder="Name" class="w-full text-xs p-1.5 border rounded">
                  </div>
                  <div class="bg-white border border-gray-200 rounded-lg p-3">
                    <div class="text-[10px] font-bold text-gray-600 uppercase mb-2">Approved By <span
                        class="font-normal text-gray-400">(Manager)</span></div>
                    <div class="h-12 border-2 border-dashed border-gray-200 rounded mb-2"></div><input type="text"
                      placeholder="Name" class="w-full text-xs p-1.5 border rounded">
                  </div>
                  <div class="bg-white border border-gray-200 rounded-lg p-3">
                    <div class="text-[10px] font-bold text-gray-600 uppercase mb-2">Transported By <span
                        class="font-normal text-gray-400">(Driver)</span></div>
                    <div class="h-12 border-2 border-dashed border-gray-200 rounded mb-2"></div><input type="text"
                      placeholder="Name" class="w-full text-xs p-1.5 border rounded">
                  </div>
                  <div class="bg-white border border-gray-200 rounded-lg p-3">
                    <div class="text-[10px] font-bold text-gray-600 uppercase mb-2">Witness By <span
                        class="font-normal text-gray-400">(Estate)</span></div>
                    <div class="h-12 border-2 border-dashed border-gray-200 rounded mb-2"></div><input type="text"
                      placeholder="Name" class="w-full text-xs p-1.5 border rounded">
                  </div>
                  <div class="bg-white border border-gray-200 rounded-lg p-3">
                    <div class="text-[10px] font-bold text-gray-600 uppercase mb-2">Verified By <span
                        class="font-normal text-gray-400">(Security)</span></div>
                    <div class="h-12 border-2 border-dashed border-gray-200 rounded mb-2"></div><input type="text"
                      placeholder="Name" class="w-full text-xs p-1.5 border rounded">
                  </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                  <div class="bg-white border border-gray-200 rounded-lg p-3">
                    <div class="text-[10px] font-bold text-gray-600 uppercase mb-2">Witnessed By <span
                        class="font-normal text-gray-400">(Receiving)</span></div>
                    <div class="h-12 border-2 border-dashed border-gray-200 rounded mb-2"></div><input type="text"
                      placeholder="Name" class="w-full text-xs p-1.5 border rounded">
                  </div>
                  <div class="bg-white border border-gray-200 rounded-lg p-3">
                    <div class="text-[10px] font-bold text-gray-600 uppercase mb-2">Received By <span
                        class="font-normal text-gray-400">(Supervisor)</span></div>
                    <div class="h-12 border-2 border-dashed border-gray-200 rounded mb-2"></div><input type="text"
                      placeholder="Name" class="w-full text-xs p-1.5 border rounded">
                  </div>
                  <div class="bg-white border border-gray-200 rounded-lg p-3">
                    <div class="text-[10px] font-bold text-gray-600 uppercase mb-2">Verified Completion <span
                        class="font-normal text-gray-400">(Security)</span></div>
                    <div class="h-12 border-2 border-dashed border-gray-200 rounded mb-2"></div><input type="text"
                      placeholder="Name" class="w-full text-xs p-1.5 border rounded">
                  </div>
                </div>
              </div>

              <div class="bg-gray-100 border-t-2 border-gray-300 p-3 mt-6 flex gap-3 flex-wrap">
                <span class="text-[10px] font-bold text-gray-500 uppercase px-2 py-1 bg-white border rounded">Original:
                  SKFP Office</span>
                <span class="text-[10px] font-bold text-gray-500 uppercase px-2 py-1 bg-white border rounded">2nd Copy:
                  SAL</span>
                <span class="text-[10px] font-bold text-gray-500 uppercase px-2 py-1 bg-white border rounded">3rd Copy:
                  Issuing Office</span>
              </div>

              <div class="flex gap-3 mt-6">
                <button type="submit"
                  class="px-6 py-2.5 bg-primary text-white rounded-lg font-bold hover:bg-primary-dark shadow-md transition-all text-sm"><i
                    class="fas fa-paper-plane mr-2"></i>Submit for Verification</button>
                <button type="button"
                  class="px-4 py-2.5 border border-gray-200 rounded-lg text-gray-600 font-medium hover:bg-gray-50 text-sm">Save
                  as Draft</button>
                <button type="button" onclick="resetForm('ctv')"
                  class="px-4 py-2.5 border border-gray-200 rounded-lg text-gray-600 font-medium hover:bg-gray-50 text-sm">Reset</button>
              </div>
            </div>
          </div>
        </form>
      </div>

      <!-- Create Receival Page -->
      <div id="page-create-receival" class="page hidden">
        <div class="mb-8">
          <h1 class="text-2xl font-bold text-gray-900 tracking-tight">Cattle Receival Form</h1>
          <p class="text-sm text-gray-500 mt-1">Record incoming cattle shipments.</p>
        </div>
        <form id="receival-form">
          <div class="bg-gray-900 text-white px-5 py-3 rounded-lg mb-6">
            <div class="font-bold text-sm">SAWIT KINABALU FARM PRODUCTS SDN BHD</div>
          </div>
          <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
            <div class="p-5 border-b border-gray-100">
              <h3 class="text-lg font-bold text-gray-900 flex items-center gap-2"><i
                  class="fas fa-clipboard-check text-primary"></i> CATTLE RECEIVAL FORM</h3>
            </div>
            <div class="p-6">
              <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div><label class="block text-xs font-bold text-gray-600 uppercase tracking-wide mb-1.5">Date
                    *</label><input type="date"
                    class="w-full p-2.5 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-primary outline-none"
                    id="receival-date" required></div>
                <div><label
                    class="block text-xs font-bold text-gray-600 uppercase tracking-wide mb-1.5">Time</label><input
                    type="time"
                    class="w-full p-2.5 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-primary outline-none"
                    id="receival-time"></div>
                <div><label class="block text-xs font-bold text-gray-600 uppercase tracking-wide mb-1.5">From
                    *</label><input type="text"
                    class="w-full p-2.5 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-primary outline-none"
                    id="receival-from" required></div>
                <div><label class="block text-xs font-bold text-gray-600 uppercase tracking-wide mb-1.5">Vehicle
                    *</label><input type="text"
                    class="w-full p-2.5 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-primary outline-none"
                    id="receival-vehicle" required></div>
              </div>
              <h4 class="text-sm font-bold text-gray-800 mb-3 pb-2 border-b-2 border-primary flex items-center gap-2"><i
                  class="fas fa-list text-primary"></i> Livestock Particulars</h4>
              <div class="overflow-x-auto mb-4">
                <table class="w-full text-left whitespace-nowrap min-w-[900px]">
                  <thead>
                    <tr class="bg-primary text-white text-xs">
                      <th class="p-3">No.</th>
                      <th class="p-3">Tag No.</th>
                      <th class="p-3">Category</th>
                      <th class="p-3">Colour</th>
                      <th class="p-3">Weight</th>
                      <th class="p-3">Normal</th>
                      <th class="p-3">Abnormal</th>
                      <th class="p-3">Remarks</th>
                      <th class="p-3">Yard</th>
                      <th class="p-3"></th>
                    </tr>
                  </thead>
                  <tbody id="receival-livestock-body" class="text-sm"></tbody>
                </table>
              </div>
              <button type="button" onclick="addReceivalRow()"
                class="px-4 py-2 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 text-sm font-medium hover:border-primary hover:text-primary transition-colors"><i
                  class="fas fa-plus mr-2"></i>Add Livestock</button>
              <div class="bg-gray-50 border border-gray-200 rounded-xl p-5 mt-6">
                <h4 class="text-sm font-bold text-gray-800 mb-4 pb-2 border-b-2 border-primary flex items-center gap-2">
                  <i class="fas fa-signature text-primary"></i> Signatures</h4>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                  <div class="bg-white border border-gray-200 rounded-lg p-3">
                    <div class="text-[10px] font-bold text-gray-600 uppercase mb-2">Prepared By</div>
                    <div class="h-12 border-2 border-dashed border-gray-200 rounded mb-2"></div><input type="text"
                      placeholder="Name" class="w-full text-xs p-1.5 border rounded">
                  </div>
                  <div class="bg-white border border-gray-200 rounded-lg p-3">
                    <div class="text-[10px] font-bold text-gray-600 uppercase mb-2">Witness By</div>
                    <div class="h-12 border-2 border-dashed border-gray-200 rounded mb-2"></div><input type="text"
                      placeholder="Name" class="w-full text-xs p-1.5 border rounded">
                  </div>
                  <div class="bg-white border border-gray-200 rounded-lg p-3">
                    <div class="text-[10px] font-bold text-gray-600 uppercase mb-2">Verified By</div>
                    <div class="h-12 border-2 border-dashed border-gray-200 rounded mb-2"></div><input type="text"
                      placeholder="Name" class="w-full text-xs p-1.5 border rounded">
                  </div>
                </div>
              </div>
              <div class="flex gap-3 mt-6">
                <button type="submit"
                  class="px-6 py-2.5 bg-primary text-white rounded-lg font-bold hover:bg-primary-dark shadow-md transition-all text-sm"><i
                    class="fas fa-check mr-2"></i>Submit Verification</button>
                <button type="button"
                  class="px-4 py-2.5 border border-gray-200 rounded-lg text-gray-600 font-medium hover:bg-gray-50 text-sm">Save
                  as Draft</button>
                <button type="button" onclick="resetForm('receival')"
                  class="px-4 py-2.5 border border-gray-200 rounded-lg text-gray-600 font-medium hover:bg-gray-50 text-sm">Reset</button>
              </div>
            </div>
          </div>
        </form>
      </div>

      <!-- Create SIV Page -->
      <div id="page-create-siv" class="page hidden">
        <div class="mb-8">
          <h1 class="text-2xl font-bold text-gray-900 tracking-tight">Sales Issue Voucher (SIV)</h1>
          <p class="text-sm text-gray-500 mt-1">Process sales and cattle transfers.</p>
        </div>
        <form id="siv-form">
          <div class="bg-gray-900 text-white px-5 py-3 rounded-lg mb-6 flex justify-between items-center">
            <div class="font-bold text-sm">SAWIT KINABALU FARM PRODUCTS SDN BHD</div><span
              class="text-primary-light font-mono font-bold" id="siv-number">SIV-2025-0001</span>
          </div>
          <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
            <div class="p-5 border-b border-gray-100">
              <h3 class="text-lg font-bold text-gray-900 flex items-center gap-2"><i
                  class="fas fa-file-invoice text-primary"></i> SALES ISSUE VOUCHER</h3>
            </div>
            <div class="p-6">
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div><label class="block text-xs font-bold text-gray-600 uppercase mb-1.5">Date/Time *</label><input
                    type="datetime-local"
                    class="w-full p-2.5 border rounded-lg text-sm focus:ring-2 focus:ring-primary outline-none"
                    id="siv-datetime" required></div>
                <div><label class="block text-xs font-bold text-gray-600 uppercase mb-1.5">Customer *</label><input
                    type="text"
                    class="w-full p-2.5 border rounded-lg text-sm focus:ring-2 focus:ring-primary outline-none"
                    id="siv-customer" required></div>
                <div><label class="block text-xs font-bold text-gray-600 uppercase mb-1.5">Vehicle *</label><input
                    type="text"
                    class="w-full p-2.5 border rounded-lg text-sm focus:ring-2 focus:ring-primary outline-none"
                    id="siv-vehicle" required></div>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div><label class="block text-xs font-bold text-gray-600 uppercase mb-1.5">Driver *</label><input
                    type="text"
                    class="w-full p-2.5 border rounded-lg text-sm focus:ring-2 focus:ring-primary outline-none"
                    id="siv-driver" required></div>
                <div><label class="block text-xs font-bold text-gray-600 uppercase mb-1.5">Tel</label><input type="tel"
                    class="w-full p-2.5 border rounded-lg text-sm focus:ring-2 focus:ring-primary outline-none"
                    id="siv-tel"></div>
                <div><label class="block text-xs font-bold text-gray-600 uppercase mb-1.5">IC</label><input type="text"
                    class="w-full p-2.5 border rounded-lg text-sm focus:ring-2 focus:ring-primary outline-none"
                    id="siv-ic"></div>
              </div>
              <h4 class="text-sm font-bold text-gray-800 mb-3 pb-2 border-b-2 border-primary flex items-center gap-2"><i
                  class="fas fa-list text-primary"></i> Sales Details</h4>
              <div class="overflow-x-auto mb-4">
                <table class="w-full text-left whitespace-nowrap min-w-[800px]">
                  <thead>
                    <tr class="bg-primary text-white text-xs">
                      <th class="p-3">No.</th>
                      <th class="p-3">Cattle ID</th>
                      <th class="p-3">Category</th>
                      <th class="p-3">Colour</th>
                      <th class="p-3">Weight</th>
                      <th class="p-3">Unit Cost</th>
                      <th class="p-3">Value</th>
                      <th class="p-3">Remarks</th>
                      <th class="p-3"></th>
                    </tr>
                  </thead>
                  <tbody id="siv-livestock-body" class="text-sm"></tbody>
                  <tfoot>
                    <tr class="bg-gray-100 font-bold text-sm">
                      <td colspan="4" class="p-3 text-right">TOTAL:</td>
                      <td id="siv-total-weight" class="p-3">0</td>
                      <td class="p-3"></td>
                      <td id="siv-total-value" class="p-3">0.00</td>
                      <td colspan="2"></td>
                    </tr>
                  </tfoot>
                </table>
              </div>
              <button type="button" onclick="addSIVRow()"
                class="px-4 py-2 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 text-sm font-medium hover:border-primary hover:text-primary transition-colors"><i
                  class="fas fa-plus mr-2"></i>Add Item</button>
              <div class="bg-gray-50 border border-gray-200 rounded-xl p-5 mt-6">
                <h4 class="text-sm font-bold text-gray-800 mb-4 pb-2 border-b-2 border-primary flex items-center gap-2">
                  <i class="fas fa-signature text-primary"></i> Signatures</h4>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                  <div class="bg-white border border-gray-200 rounded-lg p-3">
                    <div class="text-[10px] font-bold text-gray-600 uppercase mb-2">Requested By</div>
                    <div class="h-12 border-2 border-dashed border-gray-200 rounded mb-2"></div><input type="text"
                      placeholder="Name" class="w-full text-xs p-1.5 border rounded"><input type="date"
                      class="w-full text-xs p-1.5 border rounded mt-1">
                  </div>
                  <div class="bg-white border border-gray-200 rounded-lg p-3">
                    <div class="text-[10px] font-bold text-gray-600 uppercase mb-2">Verified By</div>
                    <div class="h-12 border-2 border-dashed border-gray-200 rounded mb-2"></div><input type="text"
                      placeholder="Name" class="w-full text-xs p-1.5 border rounded"><input type="date"
                      class="w-full text-xs p-1.5 border rounded mt-1">
                  </div>
                  <div class="bg-white border border-gray-200 rounded-lg p-3">
                    <div class="text-[10px] font-bold text-gray-600 uppercase mb-2">Approved By</div>
                    <div class="h-12 border-2 border-dashed border-gray-200 rounded mb-2"></div><input type="text"
                      placeholder="Name" class="w-full text-xs p-1.5 border rounded"><input type="date"
                      class="w-full text-xs p-1.5 border rounded mt-1">
                  </div>
                  <div class="bg-white border border-gray-200 rounded-lg p-3">
                    <div class="text-[10px] font-bold text-gray-600 uppercase mb-2">Received By</div>
                    <div class="h-12 border-2 border-dashed border-gray-200 rounded mb-2"></div><input type="text"
                      placeholder="Name" class="w-full text-xs p-1.5 border rounded"><input type="date"
                      class="w-full text-xs p-1.5 border rounded mt-1">
                  </div>
                </div>
              </div>
              <div class="flex gap-3 mt-6">
                <button type="submit"
                  class="px-6 py-2.5 bg-primary text-white rounded-lg font-bold hover:bg-primary-dark shadow-md transition-all text-sm"><i
                    class="fas fa-check mr-2"></i>Approve & Complete</button>
                <button type="button"
                  class="px-4 py-2.5 border border-gray-200 rounded-lg text-gray-600 font-medium hover:bg-gray-50 text-sm">Save
                  as Draft</button>
                <button type="button" onclick="resetForm('siv')"
                  class="px-4 py-2.5 border border-gray-200 rounded-lg text-gray-600 font-medium hover:bg-gray-50 text-sm">Reset</button>
              </div>
            </div>
          </div>
        </form>
      </div>

      <!-- Pending Page -->
      <div id="page-pending" class="page hidden">
        <div class="mb-8">
          <h1 class="text-2xl font-bold text-gray-900 tracking-tight">Pending Approvals</h1>
          <p class="text-sm text-gray-500 mt-1">Documents awaiting your action.</p>
        </div>
        <div
          class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4 bg-white p-4 rounded-xl border border-gray-200 shadow-sm">
          <div class="flex flex-1 gap-2 w-full md:w-auto">
            <div class="relative flex-1"><i
                class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i><input
                type="text" placeholder="Search documents..."
                class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-200 outline-none text-sm focus:ring-2 focus:ring-primary">
            </div>
            <select class="px-3 py-2 rounded-lg border border-gray-200 bg-gray-50 text-gray-600 text-sm">
              <option value="">All Types</option>
              <option>CTV</option>
              <option>Receival</option>
              <option>SIV</option>
            </select>
          </div>
        </div>
        <div class="bg-white rounded-xl shadow-sm overflow-hidden border border-gray-200">
          <div class="overflow-x-auto">
            <table class="w-full text-left whitespace-nowrap">
              <thead>
                <tr class="bg-primary text-white text-sm">
                  <th class="p-4 font-semibold">Document</th>
                  <th class="p-4 font-semibold">Type</th>
                  <th class="p-4 font-semibold">Date</th>
                  <th class="p-4 font-semibold">From</th>
                  <th class="p-4 font-semibold">To</th>
                  <th class="p-4 font-semibold">Cattle</th>
                  <th class="p-4 font-semibold">Current Step</th>
                  <th class="p-4 font-semibold text-right">Actions</th>
                </tr>
              </thead>
              <tbody id="pending-table" class="divide-y text-sm text-gray-700"></tbody>
            </table>
          </div>
          <div class="p-4 border-t bg-gray-50 flex items-center justify-between">
            <p class="text-sm text-gray-500 font-medium">Showing pending documents</p>
            <div class="flex gap-2">
              <button class="w-8 h-8 flex items-center justify-center border rounded-lg bg-white disabled:opacity-50"><i
                  class="fas fa-chevron-left text-xs"></i></button>
              <button class="w-8 h-8 flex items-center justify-center border rounded-lg bg-white disabled:opacity-50"><i
                  class="fas fa-chevron-right text-xs"></i></button>
            </div>
          </div>
        </div>
      </div>

      <!-- Completed Page -->
      <div id="page-completed" class="page hidden">
        <div class="mb-8">
          <h1 class="text-2xl font-bold text-gray-900 tracking-tight">Completed Documents</h1>
          <p class="text-sm text-gray-500 mt-1">Successfully completed transfers.</p>
        </div>
        <div class="bg-white rounded-xl shadow-sm overflow-hidden border border-gray-200">
          <div class="overflow-x-auto">
            <table class="w-full text-left whitespace-nowrap">
              <thead>
                <tr class="bg-primary text-white text-sm">
                  <th class="p-4 font-semibold">Document</th>
                  <th class="p-4 font-semibold">Type</th>
                  <th class="p-4 font-semibold">Date</th>
                  <th class="p-4 font-semibold">From</th>
                  <th class="p-4 font-semibold">To</th>
                  <th class="p-4 font-semibold">Cattle</th>
                  <th class="p-4 font-semibold">Value</th>
                  <th class="p-4 font-semibold text-right">Actions</th>
                </tr>
              </thead>
              <tbody id="completed-table" class="divide-y text-sm text-gray-700"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- History Page -->
      <div id="page-history" class="page hidden">
        <div class="mb-8">
          <h1 class="text-2xl font-bold text-gray-900 tracking-tight">Transfer History</h1>
          <p class="text-sm text-gray-500 mt-1">Complete audit trail of all transfers.</p>
        </div>
        <div class="bg-white rounded-xl shadow-sm overflow-hidden border border-gray-200">
          <div class="overflow-x-auto">
            <table class="w-full text-left whitespace-nowrap">
              <thead>
                <tr class="bg-primary text-white text-sm">
                  <th class="p-4 font-semibold">Document</th>
                  <th class="p-4 font-semibold">Type</th>
                  <th class="p-4 font-semibold">Date</th>
                  <th class="p-4 font-semibold">From</th>
                  <th class="p-4 font-semibold">To</th>
                  <th class="p-4 font-semibold">Cattle</th>
                  <th class="p-4 font-semibold">Status</th>
                  <th class="p-4 font-semibold text-right">Actions</th>
                </tr>
              </thead>
              <tbody id="history-table" class="divide-y text-sm text-gray-700"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Detail Modal -->
  <div id="detail-modal"
    class="fixed inset-0 z-50 hidden items-center justify-center bg-black/50 backdrop-blur-sm p-5 overflow-y-auto">
    <div
      class="bg-white rounded-xl shadow-xl w-full max-w-4xl mx-auto overflow-hidden border border-gray-100 max-h-[90vh] flex flex-col">
      <div class="flex justify-between items-center p-6 border-b border-gray-100 bg-gray-50 sticky top-0">
        <h3 class="text-lg font-bold text-gray-900 flex items-center gap-2"><i class="fas fa-file-alt text-primary"></i>
          <span id="modal-doc-id">Document Details</span></h3>
        <button onclick="closeModal()"
          class="text-gray-400 hover:text-gray-600 transition-colors w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-200"><i
            class="fas fa-times"></i></button>
      </div>
      <div class="p-6 overflow-y-auto custom-scrollbar flex-1">
        <!-- Workflow Stepper -->
        <div id="workflow-stepper" class="flex justify-center gap-2 flex-wrap p-4 bg-gray-50 rounded-xl mb-6"></div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Left Column -->
          <div class="space-y-5">
            <div class="bg-gray-50 rounded-xl p-4">
              <h4 class="text-sm font-bold text-gray-800 mb-3 flex items-center gap-2"><i
                  class="fas fa-info-circle text-primary"></i> Document Information</h4>
              <div class="space-y-2 text-sm">
                <div class="flex justify-between py-1.5 border-b border-gray-200"><span
                    class="text-gray-500">Type</span><span id="modal-type" class="font-semibold text-gray-900">-</span>
                </div>
                <div class="flex justify-between py-1.5 border-b border-gray-200"><span
                    class="text-gray-500">Date</span><span id="modal-date" class="font-semibold text-gray-900">-</span>
                </div>
                <div class="flex justify-between py-1.5 border-b border-gray-200"><span
                    class="text-gray-500">From</span><span id="modal-from" class="font-semibold text-gray-900">-</span>
                </div>
                <div class="flex justify-between py-1.5 border-b border-gray-200"><span
                    class="text-gray-500">To</span><span id="modal-to" class="font-semibold text-gray-900">-</span>
                </div>
                <div class="flex justify-between py-1.5 border-b border-gray-200"><span
                    class="text-gray-500">Vehicle</span><span id="modal-vehicle"
                    class="font-semibold text-gray-900">-</span></div>
                <div class="flex justify-between py-1.5"><span class="text-gray-500">Cattle</span><span
                    id="modal-cattle" class="font-semibold text-gray-900">-</span></div>
              </div>
            </div>
            <div class="bg-gray-50 rounded-xl p-4">
              <h4 class="text-sm font-bold text-gray-800 mb-3 flex items-center gap-2"><i
                  class="fas fa-history text-primary"></i> Document Timeline</h4>
              <div id="modal-timeline" class="space-y-4"></div>
            </div>
          </div>
          <!-- Right Column -->
          <div class="space-y-5">
            <div class="bg-gray-50 rounded-xl p-4">
              <h4 class="text-sm font-bold text-gray-800 mb-3 flex items-center gap-2"><i
                  class="fas fa-tasks text-primary"></i> Actions Required</h4>
              <div id="modal-status-info" class="mb-3"></div>
              <div id="modal-download-section"></div>
            </div>
            <div class="bg-gray-50 rounded-xl p-4">
              <h4 class="text-sm font-bold text-gray-800 mb-3 flex items-center gap-2"><i
                  class="fas fa-clipboard-check text-primary"></i> Audit Log</h4>
              <div id="modal-audit" class="max-h-48 overflow-y-auto custom-scrollbar space-y-2"></div>
            </div>
          </div>
        </div>

        <!-- Workflow Actions -->
        <div id="modal-actions" class="flex gap-3 mt-6 p-4 bg-gray-50 rounded-xl"></div>

        <!-- Attachments -->
        <div class="mt-6 p-4 bg-gray-50 rounded-xl">
          <h4 class="text-sm font-bold text-gray-800 mb-3 flex items-center gap-2"><i
              class="fas fa-paperclip text-primary"></i> Attachments</h4>
          <div
            class="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center bg-white hover:border-primary transition-colors cursor-pointer"
            onclick="document.getElementById('file-input').click()">
            <i class="fas fa-cloud-upload-alt text-4xl text-gray-300 mb-3"></i>
            <p class="text-gray-500 text-sm mb-3">Drag & drop files here or click to upload</p>
            <button
              class="px-4 py-2 bg-gray-100 border border-gray-200 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-200"><i
                class="fas fa-folder-open mr-2"></i>Browse Files</button>
            <input type="file" id="file-input" hidden accept=".pdf,.jpg,.png" onchange="handleFileUpload(event)">
          </div>
          <div id="uploaded-files" class="mt-4 space-y-2"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Workflow Definitions
    const WORKFLOWS = {
      CTV: [
        { id: 'issued', label: 'Issued', role: 'sapp', icon: 'fa-pen' },
        { id: 'approved', label: 'Approved', role: 'manager', icon: 'fa-stamp' },
        { id: 'transported', label: 'Transported', role: 'driver', icon: 'fa-truck' },
        { id: 'witness1', label: 'Witness (T)', role: 'estate', icon: 'fa-eye' },
        { id: 'verified1', label: 'Verified (T)', role: 'security', icon: 'fa-shield-alt' },
        { id: 'witness2', label: 'Witness (R)', role: 'estate', icon: 'fa-eye' },
        { id: 'received', label: 'Received', role: 'supervisor', icon: 'fa-clipboard-check' },
        { id: 'completed', label: 'Completed', role: 'security', icon: 'fa-check-double' }
      ],
      Receival: [
        { id: 'prepared', label: 'Prepared', role: 'operator', icon: 'fa-pen' },
        { id: 'witness', label: 'Witness', role: 'estate', icon: 'fa-eye' },
        { id: 'verified', label: 'Verified', role: 'supervisor', icon: 'fa-check-double' }
      ],
      SIV: [
        { id: 'requested', label: 'Requested', role: 'operator', icon: 'fa-pen' },
        { id: 'verified', label: 'Verified', role: 'supervisor', icon: 'fa-check' },
        { id: 'approved', label: 'Approved', role: 'manager', icon: 'fa-stamp' },
        { id: 'received', label: 'Received', role: 'supervisor', icon: 'fa-clipboard-check' }
      ]
    };

    const roles = {
      'sapp': { name: 'SAPP-Integration', users: ['Anis', 'Ahmad', 'Fatimah'] },
      'manager': { name: 'Livestock Manager/OIC', users: ['M Badrul', 'Alexius Ahat', 'Hasbude'] },
      'driver': { name: 'Driver', users: ['Suhaimi', 'Harizan', 'Ramu'] },
      'estate': { name: 'Estate Personal', users: ['Nur Aziza', 'Kamran', 'Mazahari'] },
      'security': { name: 'Gate House Security', users: ['Shahrinizam', 'Security Staff'] },
      'supervisor': { name: 'Livestock Supervisor/Assistant', users: ['Basir Bin Yusof', 'Mohd Noor', 'Razri', 'Mustakim'] },
      'operator': { name: 'Operator', users: ['Operator SKFP', 'Harizan', 'Ramu'] }
    };

    let currentUser = { role: '', name: '', roleLabel: '' };
    let currentDoc = null;

    // Sample Documents
    let documents = [
      {
        id: 'CTV-2025-001', type: 'CTV', date: '2025-01-22', time: '10:00',
        from: 'SG AA', to: 'SELIC', vehicle: 'SYK 6112', cattleCount: 1,
        currentStep: 2,
        steps: [
          { stepId: 'issued', completed: true, user: 'Anis', date: '2025-01-22 08:00', file: { name: 'CTV-2025-001_Original.pdf', size: '245 KB' } },
          { stepId: 'approved', completed: true, user: 'Alexius Ahat', date: '2025-01-22 09:30', file: { name: 'CTV-2025-001_Approved.pdf', size: '250 KB' } },
          { stepId: 'transported', completed: false, user: '', date: '', file: null }
        ],
        audit: [
          { action: 'Created transfer voucher', user: 'Anis (SAPP-Integration)', time: '2025-01-22 08:00' },
          { action: 'Submitted for verification', user: 'Anis (SAPP-Integration)', time: '2025-01-22 08:15' },
          { action: 'Approved and uploaded signed document', user: 'Alexius Ahat', time: '2025-01-22 09:30' }
        ],
        attachments: []
      },
      {
        id: 'CR-2025-001', type: 'Receival', date: '2025-01-22', time: '09:00',
        from: 'SKLIC Breedlot', to: 'SKFP-Butchery', vehicle: 'SYK 6113', cattleCount: 5,
        currentStep: 1,
        steps: [
          { stepId: 'prepared', completed: true, user: 'Operator SKFP', date: '2025-01-22 07:00', file: { name: 'CR-2025-001_Original.pdf', size: '180 KB' } },
          { stepId: 'witness', completed: false, user: '', date: '', file: null }
        ],
        audit: [
          { action: 'Created receival form', user: 'Operator SKFP', time: '2025-01-22 07:00' },
          { action: 'Submitted for witness signature', user: 'Operator SKFP', time: '2025-01-22 07:15' }
        ],
        attachments: []
      },
      {
        id: 'SIV-2025-1969', type: 'SIV', date: '2025-01-22',
        from: 'SKFP-Butchery', to: 'SKFP-Internal', vehicle: 'SYK 6112', cattleCount: 5, totalValue: 22980,
        currentStep: 4,
        steps: [
          { stepId: 'requested', completed: true, user: 'Harizan/Ramu', date: '22/1/2025', file: { name: 'SIV-1969_Original.pdf', size: '200 KB' } },
          { stepId: 'verified', completed: true, user: 'Simohd', date: '22/1/2025', file: { name: 'SIV-1969_Verified.pdf', size: '210 KB' } },
          { stepId: 'approved', completed: true, user: 'M Badrul', date: '22/1/2025', file: { name: 'SIV-1969_Approved.pdf', size: '220 KB' } },
          { stepId: 'received', completed: true, user: 'Razri', date: '22/1/2025', file: { name: 'SIV-1969_Completed.pdf', size: '230 KB' } }
        ],
        audit: [
          { action: 'Created sales issue voucher', user: 'Operator SKFP-Butchery', time: '2025-01-22 10:00' },
          { action: 'Verified by Supervisor', user: 'Simohd Askebun Abdullah', time: '2025-01-22 10:30' },
          { action: 'Approved by Manager', user: 'M Badrul', time: '2025-01-22 11:00' },
          { action: 'Received by Supervisor', user: 'Razri B Mohd Noor', time: '2025-01-22 11:30' }
        ],
        attachments: []
      }
    ];

    let ctvRowCount = 0, receivalRowCount = 0, sivRowCount = 0;

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      initNavigation();
      initRoleSwitcher();
      initForms();
      initDatePickers();
      renderDashboard();
      renderAllTables();
      addCTVRow();
      addReceivalRow();
      addSIVRow();
    });

    // Navigation
    function initNavigation() {
      document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', () => showPage(item.dataset.page));
      });
    }

    function showPage(pageName) {
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.toggle('active', item.dataset.page === pageName);
        item.classList.toggle('bg-white/15', item.dataset.page === pageName);
        item.classList.toggle('border-l-white', item.dataset.page === pageName);
      });
      document.querySelectorAll('.page').forEach(page => page.classList.add('hidden'));
      document.getElementById(`page-${pageName}`).classList.remove('hidden');

      const titles = {
        'dashboard': { title: 'Dashboard', subtitle: 'Overview of cattle transfer activities' },
        'create-ctv': { title: 'Create Transfer Voucher (CTV)', subtitle: 'Create new inter-unit transfer document' },
        'create-receival': { title: 'Cattle Receival Form', subtitle: 'Record incoming cattle shipments' },
        'create-siv': { title: 'Sales Issue Voucher (SIV)', subtitle: 'Process sales and cattle transfers' },
        'pending': { title: 'Pending Approvals', subtitle: 'Items awaiting your action' },
        'completed': { title: 'Completed Documents', subtitle: 'Successfully completed transfers' },
        'history': { title: 'Transfer History', subtitle: 'Complete audit trail of all transfers' }
      };
      document.getElementById('page-title').textContent = titles[pageName]?.title || pageName;
      document.getElementById('page-subtitle').textContent = titles[pageName]?.subtitle || '';

      if (pageName === 'dashboard') renderDashboard();
      if (pageName === 'pending') renderPendingTable();
      if (pageName === 'completed') renderCompletedTable();
      if (pageName === 'history') renderHistoryTable();
    }

    // Role Switcher
    function initRoleSwitcher() {
      const roleSelector = document.getElementById('role-selector');
      const userSelector = document.getElementById('user-selector');

      roleSelector.addEventListener('change', () => {
        const role = roleSelector.value;
        userSelector.innerHTML = '<option value="">Select Name</option>';
        if (role && roles[role]) {
          roles[role].users.forEach(user => {
            userSelector.innerHTML += `<option value="${user}">${user}</option>`;
          });
        }
        updateUserInfo();
      });
      userSelector.addEventListener('change', updateUserInfo);
    }

    function updateUserInfo() {
      const role = document.getElementById('role-selector').value;
      const name = document.getElementById('user-selector').value;
      const userInfo = document.getElementById('user-info');

      if (role && name && roles[role]) {
        currentUser = { role, name, roleLabel: roles[role].name };
        userInfo.classList.remove('hidden');
        userInfo.classList.add('flex');
        document.getElementById('user-avatar').textContent = name.charAt(0);
        document.getElementById('current-user-name').textContent = name;
        document.getElementById('current-user-role').textContent = roles[role].name;
      } else {
        userInfo.classList.add('hidden');
        userInfo.classList.remove('flex');
        currentUser = { role: '', name: '', roleLabel: '' };
      }
    }

    // Forms
    function initForms() {
      document.getElementById('ctv-form').addEventListener('submit', e => { e.preventDefault(); saveDocument('CTV'); });
      document.getElementById('receival-form').addEventListener('submit', e => { e.preventDefault(); saveDocument('Receival'); });
      document.getElementById('siv-form').addEventListener('submit', e => { e.preventDefault(); saveDocument('SIV'); });
    }

    function initDatePickers() {
      const today = new Date().toISOString().split('T')[0];
      const now = new Date().toISOString().slice(0, 16);
      if (document.getElementById('ctv-date')) document.getElementById('ctv-date').value = today;
      if (document.getElementById('receival-date')) document.getElementById('receival-date').value = today;
      if (document.getElementById('siv-datetime')) document.getElementById('siv-datetime').value = now;
    }

    // Livestock Rows
    function addCTVRow() {
      ctvRowCount++;
      document.getElementById('ctv-livestock-body').innerHTML += `
          <tr class="border-b hover:bg-gray-50"><td class="p-3">${ctvRowCount}</td><td class="p-3"><input type="text" class="w-full p-1.5 border rounded text-sm" placeholder="Tag No."></td><td class="p-3"><select class="p-1.5 border rounded text-sm"><option>WB</option><option>BC</option><option>Bull</option></select></td><td class="p-3"><input type="text" class="w-20 p-1.5 border rounded text-sm" placeholder="Colour"></td><td class="p-3"><input type="number" class="w-20 p-1.5 border rounded text-sm" placeholder="KG"></td><td class="p-3"><input type="checkbox" class="w-4 h-4 accent-primary"></td><td class="p-3"><input type="checkbox" class="w-4 h-4 accent-red-500"></td><td class="p-3"><input type="text" class="w-24 p-1.5 border rounded text-sm" placeholder="Remarks"></td><td class="p-3"><select class="p-1.5 border rounded text-sm"><option>Sale</option><option>Treatment</option><option>Slaughter</option></select></td><td class="p-3"><button type="button" onclick="this.closest('tr').remove()" class="w-7 h-7 bg-red-100 text-red-500 rounded flex items-center justify-center hover:bg-red-200"><i class="fas fa-times text-xs"></i></button></td></tr>`;
    }

    function addReceivalRow() {
      receivalRowCount++;
      document.getElementById('receival-livestock-body').innerHTML += `
          <tr class="border-b hover:bg-gray-50"><td class="p-3">${receivalRowCount}</td><td class="p-3"><input type="text" class="w-full p-1.5 border rounded text-sm" placeholder="Tag No."></td><td class="p-3"><select class="p-1.5 border rounded text-sm"><option>WB</option><option>BC</option></select></td><td class="p-3"><input type="text" class="w-20 p-1.5 border rounded text-sm" placeholder="Colour"></td><td class="p-3"><input type="number" class="w-20 p-1.5 border rounded text-sm" placeholder="KG"></td><td class="p-3"><input type="checkbox" class="w-4 h-4 accent-primary"></td><td class="p-3"><input type="checkbox" class="w-4 h-4 accent-red-500"></td><td class="p-3"><input type="text" class="w-24 p-1.5 border rounded text-sm" placeholder="Remarks"></td><td class="p-3"><input type="text" class="w-20 p-1.5 border rounded text-sm" placeholder="Yard"></td><td class="p-3"><button type="button" onclick="this.closest('tr').remove()" class="w-7 h-7 bg-red-100 text-red-500 rounded flex items-center justify-center hover:bg-red-200"><i class="fas fa-times text-xs"></i></button></td></tr>`;
    }

    function addSIVRow() {
      sivRowCount++;
      document.getElementById('siv-livestock-body').innerHTML += `
          <tr class="border-b hover:bg-gray-50"><td class="p-3">${sivRowCount}</td><td class="p-3"><input type="text" class="w-full p-1.5 border rounded text-sm" placeholder="ID"></td><td class="p-3"><select class="p-1.5 border rounded text-sm"><option>WB</option><option>BC</option></select></td><td class="p-3"><input type="text" class="w-20 p-1.5 border rounded text-sm" placeholder="Colour"></td><td class="p-3"><input type="number" class="w-20 p-1.5 border rounded text-sm" onchange="calcSIVRow(this)" placeholder="KG"></td><td class="p-3"><input type="number" class="w-20 p-1.5 border rounded text-sm" step="0.01" onchange="calcSIVRow(this)" placeholder="RM"></td><td class="p-3"><span class="row-value font-semibold">0.00</span></td><td class="p-3"><input type="text" class="w-24 p-1.5 border rounded text-sm" placeholder="Remarks"></td><td class="p-3"><button type="button" onclick="this.closest('tr').remove();updateSIVTotals()" class="w-7 h-7 bg-red-100 text-red-500 rounded flex items-center justify-center hover:bg-red-200"><i class="fas fa-times text-xs"></i></button></td></tr>`;
    }

    function calcSIVRow(el) {
      const row = el.closest('tr');
      const weight = parseFloat(row.cells[4].querySelector('input').value) || 0;
      const cost = parseFloat(row.cells[5].querySelector('input').value) || 0;
      row.cells[6].querySelector('.row-value').textContent = (weight * cost).toFixed(2);
      updateSIVTotals();
    }

    function updateSIVTotals() {
      let totalWeight = 0, totalValue = 0;
      document.querySelectorAll('#siv-livestock-body tr').forEach(row => {
        totalWeight += parseFloat(row.cells[4]?.querySelector('input')?.value) || 0;
        totalValue += parseFloat(row.cells[6]?.querySelector('.row-value')?.textContent) || 0;
      });
      document.getElementById('siv-total-weight').textContent = totalWeight;
      document.getElementById('siv-total-value').textContent = totalValue.toFixed(2);
    }

    // Save Document
    function saveDocument(type) {
      const workflow = WORKFLOWS[type];
      const count = documents.filter(d => d.type === type).length + 1;
      let id, date, from, to, vehicle, cattleCount;

      if (type === 'CTV') {
        id = `CTV-2025-${String(count).padStart(3, '0')}`;
        date = document.getElementById('ctv-date').value;
        from = document.getElementById('ctv-from').value;
        to = document.getElementById('ctv-to').value;
        vehicle = document.getElementById('ctv-vehicle').value;
        cattleCount = document.querySelectorAll('#ctv-livestock-body tr').length;
      } else if (type === 'Receival') {
        id = `CR-2025-${String(count).padStart(3, '0')}`;
        date = document.getElementById('receival-date').value;
        from = document.getElementById('receival-from').value;
        to = 'SKFP-Butchery';
        vehicle = document.getElementById('receival-vehicle').value;
        cattleCount = document.querySelectorAll('#receival-livestock-body tr').length;
      } else {
        id = `SIV-2025-${String(count).padStart(4, '0')}`;
        date = document.getElementById('siv-datetime').value.split('T')[0];
        from = 'SKFP-Butchery';
        to = document.getElementById('siv-customer').value;
        vehicle = document.getElementById('siv-vehicle').value;
        cattleCount = document.querySelectorAll('#siv-livestock-body tr').length;
      }

      const doc = {
        id, type, date, from, to, vehicle, cattleCount,
        currentStep: 1,
        steps: [{ stepId: workflow[0].id, completed: true, user: currentUser.name || 'System', date: new Date().toLocaleString(), file: { name: `${id}_Original.pdf`, size: '200 KB' } }],
        audit: [{ action: `Created ${type} document`, user: currentUser.name || 'System', time: new Date().toLocaleString() }],
        attachments: [],
        totalValue: type === 'SIV' ? parseFloat(document.getElementById('siv-total-value')?.textContent) || 0 : 0
      };

      documents.unshift(doc);
      updateDocNumbers();
      alert(`${type} saved successfully! Document ID: ${id}`);
      showPage('pending');
    }

    function updateDocNumbers() {
      const ctvCount = documents.filter(d => d.type === 'CTV').length + 1;
      const sivCount = documents.filter(d => d.type === 'SIV').length + 1;
      if (document.getElementById('ctv-number')) document.getElementById('ctv-number').textContent = `CTV-2025-${String(ctvCount).padStart(3, '0')}`;
      if (document.getElementById('siv-number')) document.getElementById('siv-number').textContent = `SIV-2025-${String(sivCount).padStart(4, '0')}`;
    }

    function resetForm(type) {
      if (type === 'ctv') { document.getElementById('ctv-form').reset(); document.getElementById('ctv-livestock-body').innerHTML = ''; ctvRowCount = 0; addCTVRow(); }
      if (type === 'receival') { document.getElementById('receival-form').reset(); document.getElementById('receival-livestock-body').innerHTML = ''; receivalRowCount = 0; addReceivalRow(); }
      if (type === 'siv') { document.getElementById('siv-form').reset(); document.getElementById('siv-livestock-body').innerHTML = ''; sivRowCount = 0; addSIVRow(); }
      initDatePickers();
    }

    // Render Functions
    function renderDashboard() {
      const pending = documents.filter(d => d.currentStep < WORKFLOWS[d.type].length);
      const completed = documents.filter(d => d.currentStep >= WORKFLOWS[d.type].length);

      document.getElementById('stat-pending').textContent = pending.length;
      document.getElementById('stat-in-progress').textContent = pending.filter(d => d.currentStep > 0).length;
      document.getElementById('stat-completed').textContent = completed.length;
      document.getElementById('stat-total').textContent = documents.length;
      document.getElementById('pending-count').textContent = pending.length;
      document.getElementById('notif-count').textContent = pending.length;

      const recentPending = pending.slice(0, 5);
      document.getElementById('recent-pending-table').innerHTML = recentPending.length ? recentPending.map(d => {
        const wf = WORKFLOWS[d.type];
        const currentStepLabel = d.currentStep < wf.length ? wf[d.currentStep].label : 'Completed';
        return `<tr class="hover:bg-gray-50 transition-colors"><td class="p-4"><code class="bg-green-50 text-primary px-2 py-1 rounded font-bold text-xs">${d.id}</code></td><td class="p-4"><span class="px-2.5 py-0.5 bg-gray-100 rounded text-xs font-medium">${d.type}</span></td><td class="p-4">${d.from}</td><td class="p-4"><span class="px-2.5 py-0.5 bg-blue-100 text-blue-800 rounded-full text-xs font-medium border border-blue-200">${currentStepLabel}</span></td><td class="p-4 text-right"><button onclick="viewDetail('${d.id}')" class="px-3 py-1.5 bg-primary text-white rounded-lg text-xs font-medium hover:bg-primary-dark transition-colors"><i class="fas fa-eye mr-1"></i>View</button></td></tr>`;
      }).join('') : '<tr><td colspan="5" class="p-8 text-center text-gray-400 italic">No pending items</td></tr>';
    }

    function renderPendingTable() {
      const pending = documents.filter(d => d.currentStep < WORKFLOWS[d.type].length);
      document.getElementById('pending-table').innerHTML = pending.length ? pending.map(d => {
        const wf = WORKFLOWS[d.type];
        const currentStepLabel = d.currentStep < wf.length ? wf[d.currentStep].label : 'Completed';
        return `<tr class="hover:bg-gray-50 transition-colors"><td class="p-4"><code class="bg-green-50 text-primary px-2 py-1 rounded font-bold text-xs">${d.id}</code></td><td class="p-4"><span class="px-2.5 py-0.5 bg-gray-100 rounded text-xs font-medium">${d.type}</span></td><td class="p-4">${d.date}</td><td class="p-4">${d.from}</td><td class="p-4">${d.to}</td><td class="p-4">${d.cattleCount}</td><td class="p-4"><span class="px-2.5 py-0.5 bg-blue-100 text-blue-800 rounded-full text-xs font-medium border border-blue-200">${currentStepLabel}</span></td><td class="p-4 text-right flex justify-end gap-2"><button onclick="viewDetail('${d.id}')" class="w-7 h-7 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded flex items-center justify-center transition-colors"><i class="fas fa-eye text-sm"></i></button><button onclick="viewDetail('${d.id}')" class="w-7 h-7 text-gray-400 hover:text-green-600 hover:bg-green-50 rounded flex items-center justify-center transition-colors"><i class="fas fa-edit text-sm"></i></button></td></tr>`;
      }).join('') : '<tr><td colspan="8" class="p-8 text-center text-gray-400 italic">No pending documents</td></tr>';
    }

    function renderCompletedTable() {
      const completed = documents.filter(d => d.currentStep >= WORKFLOWS[d.type].length);
      document.getElementById('completed-table').innerHTML = completed.length ? completed.map(d => {
        return `<tr class="hover:bg-gray-50 transition-colors"><td class="p-4"><code class="bg-green-50 text-primary px-2 py-1 rounded font-bold text-xs">${d.id}</code></td><td class="p-4"><span class="px-2.5 py-0.5 bg-gray-100 rounded text-xs font-medium">${d.type}</span></td><td class="p-4">${d.date}</td><td class="p-4">${d.from}</td><td class="p-4">${d.to}</td><td class="p-4">${d.cattleCount}</td><td class="p-4">${d.totalValue ? 'RM ' + d.totalValue.toLocaleString() : '-'}</td><td class="p-4 text-right"><button onclick="viewDetail('${d.id}')" class="w-7 h-7 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded flex items-center justify-center transition-colors"><i class="fas fa-eye text-sm"></i></button></td></tr>`;
      }).join('') : '<tr><td colspan="8" class="p-8 text-center text-gray-400 italic">No completed documents</td></tr>';
    }

    function renderHistoryTable() {
      document.getElementById('history-table').innerHTML = documents.length ? documents.map(d => {
        const wf = WORKFLOWS[d.type];
        const isCompleted = d.currentStep >= wf.length;
        const statusLabel = isCompleted ? 'Completed' : wf[d.currentStep].label;
        const statusClass = isCompleted ? 'bg-green-100 text-green-800 border-green-200' : 'bg-blue-100 text-blue-800 border-blue-200';
        return `<tr class="hover:bg-gray-50 transition-colors"><td class="p-4"><code class="bg-green-50 text-primary px-2 py-1 rounded font-bold text-xs">${d.id}</code></td><td class="p-4"><span class="px-2.5 py-0.5 bg-gray-100 rounded text-xs font-medium">${d.type}</span></td><td class="p-4">${d.date}</td><td class="p-4">${d.from}</td><td class="p-4">${d.to}</td><td class="p-4">${d.cattleCount}</td><td class="p-4"><span class="px-2.5 py-0.5 ${statusClass} rounded-full text-xs font-medium border">${statusLabel}</span></td><td class="p-4 text-right"><button onclick="viewDetail('${d.id}')" class="w-7 h-7 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded flex items-center justify-center transition-colors"><i class="fas fa-eye text-sm"></i></button></td></tr>`;
      }).join('') : '<tr><td colspan="8" class="p-8 text-center text-gray-400 italic">No records</td></tr>';
    }

    function renderAllTables() { renderPendingTable(); renderCompletedTable(); renderHistoryTable(); }

    // Modal Functions
    function viewDetail(id) {
      const doc = documents.find(d => d.id === id);
      if (!doc) return;
      currentDoc = doc;

      const workflow = WORKFLOWS[doc.type];
      const isCompleted = doc.currentStep >= workflow.length;

      document.getElementById('modal-doc-id').textContent = doc.id;
      document.getElementById('modal-type').textContent = doc.type === 'CTV' ? 'Cattle Transfer Voucher' : doc.type === 'SIV' ? 'Sales Issue Voucher' : 'Cattle Receival Form';
      document.getElementById('modal-date').textContent = doc.date;
      document.getElementById('modal-from').textContent = doc.from;
      document.getElementById('modal-to').textContent = doc.to;
      document.getElementById('modal-vehicle').textContent = doc.vehicle;
      document.getElementById('modal-cattle').textContent = doc.cattleCount;

      // Workflow stepper
      let stepperHtml = '';
      workflow.forEach((step, idx) => {
        const stepData = doc.steps.find(s => s.stepId === step.id);
        const isStepCompleted = stepData?.completed;
        const isActive = idx === doc.currentStep;
        const iconClass = isStepCompleted ? 'bg-green-500 text-white' : (isActive ? 'bg-white border-2 border-primary text-primary' : 'bg-gray-200 text-gray-400');
        const labelClass = (isStepCompleted || isActive) ? 'text-gray-800 font-semibold' : 'text-gray-400';
        stepperHtml += `<div class="flex flex-col items-center min-w-[70px]"><div class="w-10 h-10 rounded-full ${iconClass} flex items-center justify-center text-sm mb-1"><i class="fas ${isStepCompleted ? 'fa-check' : step.icon}"></i></div><span class="text-[10px] ${labelClass} text-center">${step.label}</span></div>`;
        if (idx < workflow.length - 1) stepperHtml += `<div class="text-gray-300 pb-5"><i class="fas fa-chevron-right text-xs"></i></div>`;
      });
      document.getElementById('workflow-stepper').innerHTML = stepperHtml;

      // Timeline
      let timelineHtml = '';
      doc.steps.filter(s => s.completed).forEach(step => {
        const stepDef = workflow.find(w => w.id === step.stepId);
        timelineHtml += `<div class="flex gap-3"><div class="w-3 h-3 bg-primary rounded-full mt-1 flex-shrink-0"></div><div class="flex-1 pb-4"><div class="flex justify-between items-center"><span class="font-semibold text-gray-800 text-sm">${stepDef?.label || step.stepId}</span><span class="text-xs text-gray-400">${step.date}</span></div><div class="text-xs text-gray-500 mb-2">By ${step.user}</div>${step.file ? `<div class="flex items-center gap-3 p-2.5 bg-white border rounded-lg"><div class="w-8 h-8 bg-red-50 text-red-500 rounded flex items-center justify-center"><i class="fas fa-file-pdf text-sm"></i></div><div class="flex-1"><div class="text-xs font-medium text-gray-800">${step.file.name}</div><div class="text-[10px] text-gray-400">${step.file.size}</div></div><button onclick="downloadFile('${step.file.name}')" class="w-8 h-8 bg-gray-100 rounded flex items-center justify-center text-gray-500 hover:bg-gray-200"><i class="fas fa-download text-xs"></i></button></div>` : ''}</div></div>`;
      });
      document.getElementById('modal-timeline').innerHTML = timelineHtml || '<p class="text-gray-400 italic text-sm">No documents uploaded yet</p>';

      // Status
      const currentStepDef = workflow[doc.currentStep];
      let statusHtml = '';
      let downloadHtml = '';
      if (isCompleted) {
        statusHtml = '<p class="text-green-600 font-semibold text-sm"><i class="fas fa-check-circle mr-2"></i>Document Completed</p>';
      } else {
        statusHtml = `<p class="text-sm">Current step: <strong>${currentStepDef.label}</strong></p>`;
        const lastFile = doc.steps.filter(s => s.completed && s.file).pop()?.file;
        if (lastFile) {
          downloadHtml = `<button onclick="downloadFile('${lastFile.name}')" class="mt-3 px-4 py-2 bg-primary text-white rounded-lg text-sm font-medium hover:bg-primary-dark transition-colors"><i class="fas fa-download mr-2"></i>Download PDF</button>`;
        }
      }
      document.getElementById('modal-status-info').innerHTML = statusHtml;
      document.getElementById('modal-download-section').innerHTML = downloadHtml;

      // Actions
      let actionsHtml = '';
      if (!isCompleted) {
        actionsHtml = `<button onclick="authorizeStep()" class="px-4 py-2 bg-green-600 text-white rounded-lg text-sm font-bold hover:bg-green-700 transition-colors"><i class="fas fa-check mr-2"></i>Authorize</button><button onclick="returnStep()" class="px-4 py-2 bg-amber-500 text-white rounded-lg text-sm font-bold hover:bg-amber-600 transition-colors"><i class="fas fa-undo mr-2"></i>Return</button>`;
      }
      document.getElementById('modal-actions').innerHTML = actionsHtml;

      // Audit
      document.getElementById('modal-audit').innerHTML = doc.audit.map(a => `<div class="flex gap-2 py-2 border-b border-gray-100 last:border-0"><div class="w-2 h-2 bg-primary rounded-full mt-1.5 flex-shrink-0"></div><div class="flex-1"><div class="text-sm text-gray-800"><strong>${a.user}</strong> - ${a.action}</div><div class="text-xs text-gray-400">${a.time}</div></div></div>`).join('');

      // Show modal
      const modal = document.getElementById('detail-modal');
      modal.classList.remove('hidden');
      modal.classList.add('flex');
    }

    function closeModal() {
      const modal = document.getElementById('detail-modal');
      modal.classList.add('hidden');
      modal.classList.remove('flex');
      currentDoc = null;
    }

    function downloadFile(filename) {
      const doc = currentDoc;
      const content = generateFormHTML(doc);
      const blob = new Blob([content], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename.replace('.pdf', '.html');
      a.click();
      URL.revokeObjectURL(url);
      alert(`Downloaded: ${filename.replace('.pdf', '.html')}\n\nPrint this as PDF, sign it, and upload.`);
    }

    function generateFormHTML(doc) {
      const workflow = WORKFLOWS[doc.type];
      let signaturesHtml = '';
      workflow.forEach(step => {
        const stepData = doc.steps.find(s => s.stepId === step.id);
        signaturesHtml += `<div style="flex:1;border:1px solid #ccc;padding:10px;min-width:120px;"><div style="font-size:10px;font-weight:bold;margin-bottom:5px;">${step.label.toUpperCase()}</div><div style="border:1px dashed #999;height:50px;margin-bottom:5px;"></div><div style="font-size:11px;">Name: ${stepData?.user || '_____________'}</div><div style="font-size:11px;">Date: ${stepData?.date || '_____________'}</div></div>`;
      });
      return `<!DOCTYPE html><html><head><meta charset="UTF-8"><title>${doc.id}</title><style>body{font-family:Inter,Arial,sans-serif;padding:20px;font-size:12px;color:#333;}h1{font-size:16px;text-align:center;margin-bottom:5px;color:#34554a;}h2{font-size:14px;margin:15px 0 10px;border-bottom:2px solid #34554a;padding-bottom:5px;color:#34554a;}.header{background:#1f2937;color:white;padding:12px;text-align:center;margin-bottom:15px;border-radius:6px;}.info-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:15px;}.info-item{display:flex;justify-content:space-between;padding:5px;border-bottom:1px solid #eee;}.signatures{display:flex;gap:10px;flex-wrap:wrap;margin-top:20px;padding:15px;background:#f9f9f9;border-radius:8px;}table{width:100%;border-collapse:collapse;margin:10px 0;}th{background:#34554a;color:white;padding:8px;text-align:left;font-size:11px;}td{border:1px solid #ddd;padding:6px;font-size:11px;}</style></head><body><div class="header"><strong>SAWIT KINABALU FARM PRODUCTS SDN BHD</strong><br><small>Document: ${doc.id}</small></div><h1>${doc.type === 'CTV' ? 'CATTLE TRANSFER VOUCHER' : doc.type === 'SIV' ? 'SALES ISSUE VOUCHER' : 'CATTLE RECEIVAL FORM'}</h1><div class="info-grid"><div class="info-item"><span>Document No:</span><strong>${doc.id}</strong></div><div class="info-item"><span>Date:</span><strong>${doc.date}</strong></div><div class="info-item"><span>From:</span><strong>${doc.from}</strong></div><div class="info-item"><span>To:</span><strong>${doc.to}</strong></div><div class="info-item"><span>Vehicle:</span><strong>${doc.vehicle}</strong></div><div class="info-item"><span>Cattle:</span><strong>${doc.cattleCount}</strong></div></div><h2>Livestock Particulars</h2><table><thead><tr><th>No.</th><th>Tag No.</th><th>Category</th><th>Colour</th><th>Weight</th><th>Remarks</th></tr></thead><tbody><tr><td>1</td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table><h2>Signatures & Authorization</h2><div class="signatures">${signaturesHtml}</div></body></html>`;
    }

    function handleFileUpload(event) {
      const files = event.target.files;
      if (!files.length || !currentDoc) return;

      const file = files[0];
      const fileInfo = { name: file.name, size: (file.size / 1024).toFixed(1) + ' KB', date: new Date().toLocaleString() };
      currentDoc.attachments.push(fileInfo);

      const workflow = WORKFLOWS[currentDoc.type];
      if (currentDoc.currentStep < workflow.length) {
        const stepDef = workflow[currentDoc.currentStep];
        currentDoc.steps.push({ stepId: stepDef.id, completed: true, user: currentUser.name || 'System', date: new Date().toLocaleString(), file: fileInfo });
        currentDoc.audit.push({ action: `Uploaded signed document for ${stepDef.label}`, user: currentUser.name || 'System', time: new Date().toLocaleString() });
        currentDoc.currentStep++;

        alert(`File uploaded! Step "${stepDef.label}" completed.`);
        viewDetail(currentDoc.id);
        renderAllTables();
        renderDashboard();
      }
      event.target.value = '';
    }

    function authorizeStep() {
      if (!currentDoc) return;
      const workflow = WORKFLOWS[currentDoc.type];
      if (currentDoc.currentStep >= workflow.length) return;

      const stepDef = workflow[currentDoc.currentStep];
      currentDoc.steps.push({ stepId: stepDef.id, completed: true, user: currentUser.name || 'System', date: new Date().toLocaleString(), file: { name: `${currentDoc.id}_${stepDef.id}.pdf`, size: '200 KB' } });
      currentDoc.audit.push({ action: `Authorized ${stepDef.label}`, user: currentUser.name || 'System', time: new Date().toLocaleString() });
      currentDoc.currentStep++;

      alert(`Step "${stepDef.label}" authorized!`);
      viewDetail(currentDoc.id);
      renderAllTables();
      renderDashboard();
    }

    function returnStep() {
      if (!currentDoc) return;
      currentDoc.audit.push({ action: 'Document returned for revision', user: currentUser.name || 'System', time: new Date().toLocaleString() });
      alert('Document returned for revision.');
      closeModal();
    }

    // Close modal on overlay click
    document.getElementById('detail-modal').addEventListener('click', e => { if (e.target.id === 'detail-modal') closeModal(); });
  </script>
</body>

</html>
